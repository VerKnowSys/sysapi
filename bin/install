#!/bin/sh
# blame: @dmilith
# 2018-12-10-0127-1544401657


# NOTE: Explicitly set "release" as default release type:
_rel_type="${1:-release}"

. bin/common "${_rel_type}"
if [ "release" = "${_rel_type}" ]; then
    bin/clean purge
else
    bin/clean
fi


kill_and_strip () {
    killall -TERM "${_bin_name}" 2>/dev/null
    echo "Strip: SysAPI: ${_bin_product_target}" \
        && strip -s -d "${_bin_product_target}" \
        && return 0

    return 1
}


install_product () {
    install -v "${_bin_product_target}" "${_sysapi_dest_bin}" \
        && echo "Installed: SysAPI binary: ${_bin_product_target}" \
        && return 0

    return 1
}


# Strip and Install product:
bin/build "${_rel_type}" \
    && kill_and_strip \
    && install_product \
    && exit 0

exit 1
